{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "vmName": {
            "type": "string",
            "defaultValue": "Arc-Data-Client",
            "metadata": {
                "description": "The name of you Virtual Machine."
            }
        },
        "adminUsername": {
            "type": "string",
            "defaultValue": "arcdemo",
            "metadata": {
                "description": "Username for the Virtual Machine."
            }
        },
        "servicePrincipalClientId": {
            "type": "string",
            "metadata": {
                "description": "Unique SPN app ID"
            }
        },
        "servicePrincipalClientSecret": {
            "type": "string",
            "metadata": {
                "description": "Unique SPN password"
            }
        },
        "tenantId": {
            "type": "string",
            "metadata": {
                "description": "Unique SPN tenant ID"
            }
        },
        "resourceGroup": {
            "type": "string",
            "metadata": {
                "description": "Associated TINA resource group on Azure"
            }
        },
        "clusterName": {
            "type": "string",
            "metadata": {
                "description": "Target AKS cluster"
            }
        },
        "AZDATA_USERNAME": {
            "type": "string",
            "metadata": {
                "description": "Arc Data Controller Username"
            }
        },
        "AZDATA_PASSWORD": {
            "type": "string",
            "metadata": {
                "description": "Arc Data Controller Password"
            }
        },
        "ACCEPT_EULA": {
            "type": "string",
            "defaultValue":"yes",
            "metadata": {
                "description": "azdata CLI EULA"
            }
        },
        "REGISTRY_USERNAME": {
            "type": "string",
            "metadata": {
                "description": "Private Azure Arc Data Container Registry Username"
            }
        },
        "REGISTRY_PASSWORD": {
            "type": "string",
            "metadata": {
                "description": "Private Azure Arc Data Container Registry Password"
            }
        },
        "ARC_DC_NAME": {
            "type": "string",
            "metadata": {
                "description": "Arc Data Controller name"
            }
        },
        "ARC_DC_SUBSCRIPTION": {
            "type": "string",
            "metadata": {
                "description": "Arc Data Controller subscription ID"
            }
        },
        "ARC_DC_REGION": {
            "type": "string",
            "metadata": {
                "description": "Arc Data Controller Region"
            }
        },
        "DOCKER_REGISTRY": {
            "type": "string",
            "metadata": {
                "description": "Private Azure Arc Data Container Registry "
            }
        },
        "DOCKER_REPOSITORY": {
            "type": "string",
            "metadata": {
                "description": "Private Azure Arc Data Container Registry Repository"
            }
        },
        "DOCKER_TAG": {
            "type": "string",
            "metadata": {
                "description": "Private Azure Arc Data Container Image Tag"
            }
        }      
    },
    "variables": {
        "vmName": "[concat(parameters('vmName'))]"
    },
    "resources": [
        {
          "type": "Microsoft.Compute/virtualMachines/extensions",
          "name": "[concat(variables('vmName'),'/ClientTools')]",
          "apiVersion": "2015-06-15",
          "location": "[resourceGroup().location]",
          "tags": {
              "displayName": "config-choco"
          },          
          "properties": {
            "publisher": "Microsoft.Compute",
            "type": "CustomScriptExtension",
            "typeHandlerVersion": "1.4",
            "autoUpgradeMinorVersion": true,
            "settings": {
              "fileUris": [
                "https://raw.githubusercontent.com/msftcoderdjw/azure_arc/master/azure_arc_data_jumpstart/azsaks/arm_template/scripts/ClientTools.ps1"
              ],
              "commandToExecute": "[concat('powershell.exe -ExecutionPolicy Bypass -File ClientTools.ps1', ' -servicePrincipalClientId ', parameters('servicePrincipalClientId'), ' -servicePrincipalClientSecret ', parameters('servicePrincipalClientSecret'), ' -adminUsername ', parameters('adminUsername'), ' -tenantId ', parameters('tenantId'), ' -resourceGroup ', parameters('resourceGroup'), ' -clusterName ', parameters('clusterName'), ' -AZDATA_USERNAME ', parameters('AZDATA_USERNAME'), ' -AZDATA_PASSWORD ', parameters('AZDATA_PASSWORD'), ' -ACCEPT_EULA ', parameters('ACCEPT_EULA'), ' -REGISTRY_USERNAME ', parameters('REGISTRY_USERNAME'), ' -REGISTRY_PASSWORD ', parameters('REGISTRY_PASSWORD'), ' -ARC_DC_NAME ', parameters('ARC_DC_NAME'), ' -ARC_DC_SUBSCRIPTION ', parameters('ARC_DC_SUBSCRIPTION'), ' -ARC_DC_REGION ', parameters('ARC_DC_REGION'), ' -DOCKER_REGISTRY ', parameters('DOCKER_REGISTRY'), ' -DOCKER_REPOSITORY ', parameters('DOCKER_REPOSITORY'), ' -DOCKER_TAG ', parameters('DOCKER_TAG'))]" 
            }            
          }
        }                        
    ],

    
    "outputs": { }
}